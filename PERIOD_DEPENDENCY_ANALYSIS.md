# 期間依存性問題の根本原因分析

## 🚨 重大な発見

**3ヶ月一気分析 vs 月別分析で2,651%の差異**
- 月別合計: 2,018時間 (7月759 + 8月768 + 9月491)  
- 3ヶ月一気: 55,518時間
- **差異: 53,500時間**

## 🔍 期間依存性の原因

### 1. **Need計算の統計基準値変化**
```
月別分析: 各月独立の中央値/平均値/P25計算
3ヶ月分析: 3ヶ月全体の統計値で計算 → 基準値が激変
```

### 2. **データ量効果**
- **1ヶ月**: 約30日分のデータ → 安定した統計値
- **3ヶ月**: 約90日分のデータ → 外れ値・季節変動が影響

### 3. **シナリオ別影響度**
```
P25ベース: 48,972時間 (月別: 437+625+368=1,430時間)
→ 3,325%の差異！最も期間依存性が高い

平均ベース: 55,518時間 (月別: 759+768+491=2,018時間) 
→ 2,651%の差異

中央値ベース: 55,314時間 (月別: 751+749+567=2,067時間)
→ 2,576%の差異
```

## ⚠️ 問題の本質

**分析ロジックが加算性を満たしていない**
```
期待: 3ヶ月一気 ≈ 7月分 + 8月分 + 9月分
現実: 55,518時間 ≠ 2,018時間
```

これは **設計思想「全ては動的に、全ては全体最適に」に反する**

## 🎯 修正方針

### A. 統計値固定方式
1. 基準期間を設定（例：直近3ヶ月）
2. その期間の統計値を固定して使用
3. どの期間で分析しても同じ基準値

### B. 期間正規化方式  
1. 分析期間に応じて統計値を正規化
2. 月別→3ヶ月変換係数を適用
3. 加算性を保証

### C. 階層分析方式
1. 月別分析を基本単位とする
2. 長期分析は月別結果の集約
3. 統計的整合性を維持

## 🏆 推奨解決策

**B. 期間正規化方式**を採用
- 動的性を維持
- 全体最適の思想に準拠
- 加算性を数学的に保証