# 🏥 Shift-Suite：医療・介護シフト分析システム 機能概要書

## 📋 システム概要

**Shift-Suite**は、医療・介護施設のExcelシフトスケジュールを高度に分析・可視化する統合システムです。人員配置の最適化、法的準拠チェック、労働環境改善を目的とした包括的な分析プラットフォームを提供します。

---

## 🎯 システムの目的とコンセプト

### 核心的価値提案
1. **効率的な人員配置**: データドリブンな人員配置最適化
2. **法的準拠保証**: 労働基準法・業界規制の自動チェック
3. **予測的管理**: 将来の人員需要予測と計画支援
4. **労働環境改善**: 過労・偏りの早期発見と是正

### 設計哲学
- **30分スロット基準**: 医療現場に適した細かい時間管理
- **多角的分析**: ヒートマップ、統計、異常検知の統合
- **実用性重視**: 現場で使いやすいStreamlit GUI
- **拡張性**: モジュラー設計による機能追加の容易性

---

## 🔄 システム全体フロー

### 1. データ取り込み段階
```
Excel勤務表 → io_excel.py → 正規化されたlong_df → 各種分析モジュール
```

**処理内容**:
- Excelファイルの複数シート読み込み
- 勤務時間の30分スロットへの分解
- 職員情報・勤務コードの正規化
- 休日・有給情報の統合

### 2. 核心分析段階
```
long_df → [heatmap, shortage, 統計分析] → 中間結果データ
```

**主要処理**:
- 時間帯別人員配置ヒートマップ生成
- 人員不足・過剰の詳細分析
- 職種・雇用形態別統計計算

### 3. 高度分析段階
```
基本分析結果 → [Blueprint分析, 異常検知, 予測] → 洞察・推奨事項
```

**付加価値創造**:
- パターン認識による制約発見
- 法的リスク早期警告
- 将来需要予測

---

## 📊 主要機能モジュール

### コア分析機能

#### 1. **Heatmap生成** (`heatmap.py`)
**目的**: 時間帯別人員配置の可視化
- 30分単位の詳細人員配置表示
- 職種・雇用形態別の色分け表示
- 必要人数vs実際人数の比較

#### 2. **Shortage分析** (`shortage.py`)
**目的**: 人員不足・過剰の定量化
- 時間帯別不足人数の算出
- 職種・雇用形態別の不足時間計算
- 月次・日次サマリーレポート
- **出力**: `shortage_summary.txt` (例: total_lack_hours: 670)

#### 3. **統計分析** (`build_stats.py`)
**目的**: 総合KPI・トレンド分析
- 労働時間統計（月次・日次）
- 稼働率・効率性指標
- 時系列トレンド分析

### 拡張分析機能

#### 4. **Blueprint分析システム** (Phase 2/3.1)
**新機能**: 深層的制約・パターン発見

**Phase 2: 事実抽出** (`fact_extractor_prototype.py`)
- 基本労働統計の系統的抽出
- 勤務パターンの定量化
- 職種・雇用形態の分布分析

**Phase 3.1: 異常検知** (`lightweight_anomaly_detector.py`)
- 過度な労働時間の自動検出
- 連続勤務違反の発見
- 夜勤頻度異常の警告
- 勤務間インターバル違反チェック

#### 5. **予測・最適化機能**
- **需要予測** (`forecast.py`): 時系列モデルによる将来需要予測
- **採用計画** (`hire_plan.py`): 不足解消に必要な採用人数算出
- **公平性分析** (`fairness.py`): シフト配分の公平性評価
- **疲労分析** (`fatigue.py`): 職員疲労度の定量化

---

## 🛠️ 技術アーキテクチャ

### データ構造設計

#### long_df (標準化データ形式)
```python
Schema:
- ds: datetime64           # 日時（30分スロット単位）
- staff: str              # 職員名
- role: str               # 職種（介護士、看護師等）
- code: str               # 勤務コード（日勤、夜勤等）
- parsed_slots_count: int # スロット数（1スロット=30分）
- employment: str         # 雇用形態（正社員、パート等）
- holiday_type: str       # 休日種別
```

#### 時間計算の統一仕様
```python
# 基本変換公式
SLOT_MINUTES = 30                    # 30分スロット
SLOT_HOURS = SLOT_MINUTES / 60.0     # 0.5時間/スロット
労働時間 = スロット数 × SLOT_HOURS

# 計算例
4時間勤務 → 8スロット → 8 × 0.5 = 4.0時間
```

### システム統合設計

#### 1. GUI層 (`app.py` + `dash_app.py`)
- **Streamlit**: メイン分析インターフェース
- **Dash**: 高度可視化・インタラクティブダッシュボード
- **統合表示**: 分析結果の統一的な表示

#### 2. 分析エンジン層
- **コア分析**: heatmap, shortage, build_stats
- **高度分析**: blueprint, anomaly, forecast
- **共通基盤**: io_excel, utils, constants

#### 3. データ層
- **入力**: Excel勤務表、設定ファイル
- **中間**: Parquet形式の処理済みデータ
- **出力**: Excel/CSV分析結果、可視化レポート

---

## 🔍 業務フローとユースケース

### 典型的な分析ワークフロー

#### 1. 日常運用フロー
```
朝：前日シフト実績確認 → 当日人員配置調整
週：週次不足分析 → 来週シフト調整
月：月次統計レビュー → 翌月計画策定
```

#### 2. 管理者向けフロー
```
アップロード → 自動分析実行 → ダッシュボード確認 → 課題特定 → 対策立案
```

#### 3. 人事・労務フロー
```
労働時間チェック → 法的準拠確認 → 異常検知 → リスク対応
```

### 具体的活用シーン

#### シーン1: 人員不足の早期発見
- **問題**: 夜勤帯の慢性的人手不足
- **分析**: shortage.pyで時間帯別不足量を定量化
- **対策**: 特定時間帯への重点的人員配置

#### シーン2: 労働基準法違反の予防
- **問題**: 連続勤務・過重労働のリスク
- **分析**: Phase 3.1で異常パターン自動検知
- **対策**: 事前アラートによる違反防止

#### シーン3: 効率的な採用計画
- **問題**: 人員不足をどう解消するか
- **分析**: hire_plan.pyで必要採用人数を算出
- **対策**: データに基づく戦略的採用

---

## 💡 システムの特徴・強み

### 1. **精密性**
- 30分スロット単位の細かい分析
- 職種・雇用形態・時間帯の多次元分析
- 実際の業務実態に即した正確な数値化

### 2. **包括性**
- 基本統計から高度な異常検知まで
- 過去分析から将来予測まで
- 個人レベルから組織レベルまで

### 3. **実用性**
- 直感的なGUIインターフェース
- 現場で使いやすい分析結果表示
- 既存Excelワークフローとの親和性

### 4. **拡張性**
- モジュラー設計による機能追加容易性
- プラグイン型の分析モジュール
- カスタマイズ可能な設定・閾値

---

## 🎯 期待される効果・価値

### 1. **運営効率向上**
- 人員配置の最適化による生産性向上
- データドリブンな意思決定による無駄削減
- 予測による事前対応体制構築

### 2. **コンプライアンス強化**
- 労働基準法違反の事前防止
- 業界規制への確実な準拠
- 監査対応の効率化

### 3. **職員満足度向上**
- 公平なシフト配分
- 過労防止による働きやすい環境
- 透明性のある労働条件

### 4. **経営リスク軽減**
- 人員不足による事故リスク減少
- 法的リスクの最小化
- 採用・研修コストの最適化

---

## 🚀 今後の発展可能性

### 短期拡張 (3-6ヶ月)
- **AIによる自動シフト生成**
- **リアルタイム分析機能**
- **モバイル対応**

### 中期展開 (6-12ヶ月)
- **施設間ベンチマーク機能**
- **業界標準との比較分析**
- **経営指標との連携**

### 長期ビジョン (1-2年)
- **業界全体の分析プラットフォーム**
- **政策提言・標準化への貢献**
- **国際展開・多言語対応**

---

**Shift-Suite**は、医療・介護現場の人員管理を科学的・体系的に支援し、より良い労働環境と質の高いケアの両立を実現する包括的ソリューションです。

---

*Document Version: 1.0*  
*Last Updated: 2025-08-03*  
*Classification: Functional Overview*